#!/usr/bin/env python

if __name__ == '__main__':
  import os
  import subprocess
  from optparse import OptionParser
  import copilot_dashboard
  from copilot_dashboard.local_settings import SETTINGS

  iface = SETTINGS.get('SERVER_HOST', '0.0.0.0')
  port = SETTINGS.get('SERVER_PORT', '3274')
  bind = iface + ':' + port
  print ("Starting Co-Pilot Dashboard on %s..." % bind)

  mod_dir = os.path.dirname(copilot_dashboard.__file__)
  command = ["gunicorn_django", "--daemon",
                                "--workers=" + SETTINGS.get('GUNICORN_WORKERS', '2'),
                                "--bind=" + addr,
                                "--pid=" + SETTINGS.get('PID_FILE', '/tmp/copilot-dashboard.pid'),
                                "--log-level=" + SETTINGS.get('LOG_LEVEL', 'info'),
                                "--log-file=" + SETTINGS.get('LOG_FILE', '/tmp/copilot-dashboard.log'),
                                mod_dir + "/settings.py"]
  subprocess.call(command)
