#!/usr/bin/env python

if __name__ == '__main__':
  import os
  import subprocess
  from optparse import OptionParser
  import copilot_dashboard

  optparser = OptionParser()
  optparser.add_option('-b', '--bind', dest="bind", help="bind address and port (default: 0.0.0.0:3274)", default="0.0.0.0:3274")
  optparser.add_option('-l', '--log', dest="log_file", help="path of the log file (default: /tmp/copilot_dashboard.log", default="/tmp/copilot-dashboard.log")
  (options, args) = optparser.parse_args()

  print ("Starting Co-Pilot Dashboard on %s..." % options.bind)
  mod_dir = os.path.dirname(copilot_dashboard.__file__)
  command = ["gunicorn_django", "--daemon",
                                "--workers=2",
                                "--bind=" + options.bind,
                                "--pid=/tmp/copilot-dashboard.pid",
                                "--log-level=info",
                                "--log-file=" + options.log_file,
                                mod_dir + "/settings.py"]
  subprocess.call(command)
